(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=[0,2e3,1e4,3e4,null];class n{constructor(e){this._retryDelays=void 0!==e?[...e,null]:t}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class s{}s.Authorization="Authorization",s.Cookie="Cookie";class o{constructor(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}}class r{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}class i extends r{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const n=await this._innerClient.send(e);return t&&401===n.statusCode&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):n}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[s.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[s.Authorization]&&delete e.headers[s.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}class a extends Error{constructor(e,t){const n=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=n}}class c extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class l extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class h extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=n}}class d extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=n}}class _ extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=n}}class u extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class g extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=n}}var f,p,m,w,b;!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(f||(f={}));class v{constructor(){}log(e,t){}}v.instance=new v;class y{static isRequired(e,t){if(null==e)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,n){if(!(e in t))throw new Error(`Unknown ${n} value: ${e}.`)}}class k{static get isBrowser(){return!k.isNode&&"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return!k.isNode&&"object"==typeof self&&"importScripts"in self}static get isReactNative(){return!k.isNode&&"object"==typeof window&&void 0===window.document}static get isNode(){return"undefined"!=typeof process&&process.release&&"node"===process.release.name}}function S(e,t){let n="";return C(e)?(n=`Binary data of length ${e.byteLength}`,t&&(n+=`. Content: '${function(e){const t=new Uint8Array(e);let n="";return t.forEach(e=>{n+=`0x${e<16?"0":""}${e.toString(16)} `}),n.substring(0,n.length-1)}(e)}'`)):"string"==typeof e&&(n=`String data of length ${e.length}`,t&&(n+=`. Content: '${e}'`)),n}function C(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}async function E(e,t,n,s,o,r){const i={},[a,c]=I();i[a]=c,e.log(f.Trace,`(${t} transport) sending data. ${S(o,r.logMessageContent)}.`);const l=C(o)?"arraybuffer":"text",h=await n.post(s,{content:o,headers:{...i,...r.headers},responseType:l,timeout:r.timeout,withCredentials:r.withCredentials});e.log(f.Trace,`(${t} transport) request complete. Response status: ${h.statusCode}.`)}class T{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}}class x{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const n=`[${(new Date).toISOString()}] ${f[e]}: ${t}`;switch(e){case f.Critical:case f.Error:this.out.error(n);break;case f.Warning:this.out.warn(n);break;case f.Information:this.out.info(n);break;default:this.out.log(n)}}}}function I(){let e="X-SignalR-User-Agent";return k.isNode&&(e="User-Agent"),[e,R("10.0.0",A(),k.isNode?"NodeJS":"Browser",z())]}function R(e,t,n,s){let o="Microsoft SignalR/";const r=e.split(".");return o+=`${r[0]}.${r[1]}`,o+=` (${e}; `,o+=t&&""!==t?`${t}; `:"Unknown OS; ",o+=`${n}`,o+=s?`; ${s}`:"; Unknown Runtime Version",o+=")",o}function A(){if(!k.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function z(){if(k.isNode)return process.versions.node}function P(e){return e.stack?e.stack:e.message?e.message:`${e}`}class D extends r{constructor(t){if(super(),this._logger=t,"undefined"==typeof fetch||k.isNode){const e=require;this._jar=new(e("tough-cookie").CookieJar),"undefined"==typeof fetch?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("could not find global")}());if("undefined"==typeof AbortController){const e=require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new l;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let n;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),n=new l});let s,r=null;if(e.timeout){const s=e.timeout;r=setTimeout(()=>{t.abort(),this._logger.log(f.Warning,"Timeout from HTTP request."),n=new c},s)}""===e.content&&(e.content=void 0),e.content&&(e.headers=e.headers||{},C(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{s=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(e){if(n)throw n;throw this._logger.log(f.Warning,`Error from HTTP request. ${e}.`),e}finally{r&&clearTimeout(r),e.abortSignal&&(e.abortSignal.onabort=null)}if(!s.ok){const e=await $(s,"text");throw new a(e||s.statusText,s.status)}const i=$(s,e.responseType),h=await i;return new o(s.status,s.statusText,h)}getCookieString(e){let t="";return k.isNode&&this._jar&&this._jar.getCookies(e,(e,n)=>t=n.join("; ")),t}}function $(e,t){let n;switch(t){case"arraybuffer":n=e.arrayBuffer();break;case"text":default:n=e.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return n}class M extends r{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new l):e.method?e.url?new Promise((t,n)=>{const s=new XMLHttpRequest;s.open(e.method,e.url,!0),s.withCredentials=void 0===e.withCredentials||e.withCredentials,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===e.content&&(e.content=void 0),e.content&&(C(e.content)?s.setRequestHeader("Content-Type","application/octet-stream"):s.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const r=e.headers;r&&Object.keys(r).forEach(e=>{s.setRequestHeader(e,r[e])}),e.responseType&&(s.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{s.abort(),n(new l)}),e.timeout&&(s.timeout=e.timeout),s.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),s.status>=200&&s.status<300?t(new o(s.status,s.statusText,s.response||s.responseText)):n(new a(s.response||s.responseText||s.statusText,s.status))},s.onerror=()=>{this._logger.log(f.Warning,`Error from HTTP request. ${s.status}: ${s.statusText}.`),n(new a(s.statusText,s.status))},s.ontimeout=()=>{this._logger.log(f.Warning,"Timeout from HTTP request."),n(new c)},s.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class N extends r{constructor(e){if(super(),"undefined"!=typeof fetch||k.isNode)this._httpClient=new D(e);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");this._httpClient=new M(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new l):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}!function(e){e[e.None=0]="None",e[e.WebSockets=1]="WebSockets",e[e.ServerSentEvents=2]="ServerSentEvents",e[e.LongPolling=4]="LongPolling"}(p||(p={})),function(e){e[e.Text=1]="Text",e[e.Binary=2]="Binary"}(m||(m={}));class U{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class L{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,n){this._httpClient=e,this._logger=t,this._pollAbort=new U,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(y.isRequired(e,"url"),y.isRequired(t,"transferFormat"),y.isIn(t,m,"transferFormat"),this._url=e,this._logger.log(f.Trace,"(LongPolling transport) Connecting."),t===m.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[n,s]=I(),o={[n]:s,...this._options.headers},r={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===m.Binary&&(r.responseType="arraybuffer");const i=`${e}&_=${Date.now()}`;this._logger.log(f.Trace,`(LongPolling transport) polling: ${i}.`);const c=await this._httpClient.get(i,r);200!==c.statusCode?(this._logger.log(f.Error,`(LongPolling transport) Unexpected response code: ${c.statusCode}.`),this._closeError=new a(c.statusText||"",c.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,r)}async _poll(e,t){try{for(;this._running;)try{const n=`${e}&_=${Date.now()}`;this._logger.log(f.Trace,`(LongPolling transport) polling: ${n}.`);const s=await this._httpClient.get(n,t);204===s.statusCode?(this._logger.log(f.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):200!==s.statusCode?(this._logger.log(f.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),this._closeError=new a(s.statusText||"",s.statusCode),this._running=!1):s.content?(this._logger.log(f.Trace,`(LongPolling transport) data received. ${S(s.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(s.content)):this._logger.log(f.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(e){this._running?e instanceof c?this._logger.log(f.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=e,this._running=!1):this._logger.log(f.Trace,`(LongPolling transport) Poll errored after shutdown: ${e.message}`)}}finally{this._logger.log(f.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?E(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(f.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(f.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,n]=I();e[t]=n;const s={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let o;try{await this._httpClient.delete(this._url,s)}catch(e){o=e}o?o instanceof a&&(404===o.statusCode?this._logger.log(f.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(f.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(f.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(f.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(f.Trace,e),this.onclose(this._closeError)}}}class B{constructor(e,t,n,s){this._httpClient=e,this._accessToken=t,this._logger=n,this._options=s,this.onreceive=null,this.onclose=null}async connect(e,t){return y.isRequired(e,"url"),y.isRequired(t,"transferFormat"),y.isIn(t,m,"transferFormat"),this._logger.log(f.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((n,s)=>{let o,r=!1;if(t===m.Text){if(k.isBrowser||k.isWebWorker)o=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const t=this._httpClient.getCookieString(e),n={};n.Cookie=t;const[s,r]=I();n[s]=r,o=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...n,...this._options.headers}})}try{o.onmessage=e=>{if(this.onreceive)try{this._logger.log(f.Trace,`(SSE transport) data received. ${S(e.data,this._options.logMessageContent)}.`),this.onreceive(e.data)}catch(e){return void this._close(e)}},o.onerror=e=>{r?this._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},o.onopen=()=>{this._logger.log(f.Information,`SSE connected to ${this._url}`),this._eventSource=o,r=!0,n()}}catch(e){return void s(e)}}else s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this._eventSource?E(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class H{constructor(e,t,n,s,o,r){this._logger=n,this._accessTokenFactory=t,this._logMessageContent=s,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=r}async connect(e,t){let n;return y.isRequired(e,"url"),y.isRequired(t,"transferFormat"),y.isIn(t,m,"transferFormat"),this._logger.log(f.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory&&(n=await this._accessTokenFactory()),new Promise((o,r)=>{let i;e=e.replace(/^http/,"ws");const a=this._httpClient.getCookieString(e);let c=!1;if(k.isNode||k.isReactNative){const t={},[o,r]=I();t[o]=r,n&&(t[s.Authorization]=`Bearer ${n}`),a&&(t[s.Cookie]=a),i=new this._webSocketConstructor(e,void 0,{headers:{...t,...this._headers}})}else n&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n)}`);i||(i=new this._webSocketConstructor(e)),t===m.Binary&&(i.binaryType="arraybuffer"),i.onopen=t=>{this._logger.log(f.Information,`WebSocket connected to ${e}.`),this._webSocket=i,c=!0,o()},i.onerror=e=>{let t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:"There was an error with the transport",this._logger.log(f.Information,`(WebSockets transport) ${t}.`)},i.onmessage=e=>{if(this._logger.log(f.Trace,`(WebSockets transport) data received. ${S(e.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(e.data)}catch(e){return void this._close(e)}},i.onclose=e=>{if(c)this._close(e);else{let t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(t))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(f.Trace,`(WebSockets transport) sending data. ${S(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(f.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||!1!==e.wasClean&&1e3===e.code?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&"boolean"==typeof e.wasClean&&"number"==typeof e.code}}class q{constructor(e,t={}){var n;if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,y.isRequired(e,"url"),this._logger=void 0===(n=t.logger)?new x(f.Information):null===n?v.instance:void 0!==n.log?n:new x(n),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=void 0!==t.logMessageContent&&t.logMessageContent,"boolean"!=typeof t.withCredentials&&void 0!==t.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=void 0===t.withCredentials||t.withCredentials,t.timeout=void 0===t.timeout?1e5:t.timeout;let s=null,o=null;if(k.isNode){const e=require;s=e("ws"),o=e("eventsource")}k.isNode||"undefined"==typeof WebSocket||t.WebSocket?k.isNode&&!t.WebSocket&&s&&(t.WebSocket=s):t.WebSocket=WebSocket,k.isNode||"undefined"==typeof EventSource||t.EventSource?k.isNode&&!t.EventSource&&void 0!==o&&(t.EventSource=o):t.EventSource=EventSource,this._httpClient=new i(t.httpClient||new N(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||m.Binary,y.isIn(e,m,"transferFormat"),this._logger.log(f.Debug,`Starting connection with transfer format '${m[e]}'.`),"Disconnected"!==this._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,"Disconnecting"===this._connectionState){const e="Failed to start the HttpConnection before stop() was called.";return this._logger.log(f.Error,e),await this._stopPromise,Promise.reject(new l(e))}if("Connected"!==this._connectionState){const e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(f.Error,e),Promise.reject(new l(e))}this._connectionStarted=!0}send(e){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new F(this.transport)),this._sendQueue.send(e))}async stop(e){return"Disconnected"===this._connectionState?(this._logger.log(f.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===this._connectionState?(this._logger.log(f.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState="Disconnecting",this._stopPromise=new Promise(e=>{this._stopPromiseResolver=e}),await this._stopInternal(e),void await this._stopPromise)}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch(e){}if(this.transport){try{await this.transport.stop()}catch(e){this._logger.log(f.Error,`HttpConnection.transport.stop() threw error '${e}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(f.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation){if(this._options.transport!==p.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this._constructTransport(p.WebSockets),await this._startTransport(t,e)}else{let n=null,s=0;do{if(n=await this._getNegotiationResponse(t),"Disconnecting"===this._connectionState||"Disconnected"===this._connectionState)throw new l("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(n.url&&(t=n.url),n.accessToken){const e=n.accessToken;this._accessTokenFactory=()=>e,this._httpClient._accessToken=e,this._httpClient._accessTokenFactory=void 0}s++}while(n.url&&s<100);if(100===s&&n.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,n,e)}this.transport instanceof L&&(this.features.inherentKeepAlive=!0),"Connecting"===this._connectionState&&(this._logger.log(f.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(e){return this._logger.log(f.Error,"Failed to start the connection: "+e),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(e)}}async _getNegotiationResponse(e){const t={},[n,s]=I();t[n]=s;const o=this._resolveNegotiateUrl(e);this._logger.log(f.Debug,`Sending negotiation request: ${o}.`);try{const e=await this._httpClient.post(o,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(200!==e.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${e.statusCode}'`));const n=JSON.parse(e.content);return(!n.negotiateVersion||n.negotiateVersion<1)&&(n.connectionToken=n.connectionId),n.useStatefulReconnect&&!0!==this._options._useStatefulReconnect?Promise.reject(new u("Client didn't negotiate Stateful Reconnect but the server did.")):n}catch(e){let t="Failed to complete negotiation with the server: "+e;return e instanceof a&&404===e.statusCode&&(t+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(f.Error,t),Promise.reject(new u(t))}}_createConnectUrl(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+`id=${t}`:e}async _createTransport(e,t,n,s){let o=this._createConnectUrl(e,n.connectionToken);if(this._isITransport(t))return this._logger.log(f.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(o,s),void(this.connectionId=n.connectionId);const r=[],i=n.availableTransports||[];let a=n;for(const n of i){const i=this._resolveTransportOrError(n,t,s,!0===(null==a?void 0:a.useStatefulReconnect));if(i instanceof Error)r.push(`${n.transport} failed:`),r.push(i);else if(this._isITransport(i)){if(this.transport=i,!a){try{a=await this._getNegotiationResponse(e)}catch(e){return Promise.reject(e)}o=this._createConnectUrl(e,a.connectionToken)}try{return await this._startTransport(o,s),void(this.connectionId=a.connectionId)}catch(e){if(this._logger.log(f.Error,`Failed to start the transport '${n.transport}': ${e}`),a=void 0,r.push(new _(`${n.transport} failed: ${e}`,p[n.transport])),"Connecting"!==this._connectionState){const e="Failed to select transport before stop() was called.";return this._logger.log(f.Debug,e),Promise.reject(new l(e))}}}}return r.length>0?Promise.reject(new g(`Unable to connect to the server with any of the available transports. ${r.join(" ")}`,r)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case p.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new H(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case p.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new B(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case p.LongPolling:return new L(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async n=>{let s=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{s=!0}s&&this._stopConnection(n)}else this._stopConnection(n)}:this.transport.onclose=e=>this._stopConnection(e),this.transport.connect(e,t)}_resolveTransportOrError(e,t,n,s){const o=p[e.transport];if(null==o)return this._logger.log(f.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(e,t){return!e||0!==(t&e)}(t,o))return this._logger.log(f.Debug,`Skipping transport '${p[o]}' because it was disabled by the client.`),new d(`'${p[o]}' is disabled by the client.`,o);if(!(e.transferFormats.map(e=>m[e]).indexOf(n)>=0))return this._logger.log(f.Debug,`Skipping transport '${p[o]}' because it does not support the requested transfer format '${m[n]}'.`),new Error(`'${p[o]}' does not support ${m[n]}.`);if(o===p.WebSockets&&!this._options.WebSocket||o===p.ServerSentEvents&&!this._options.EventSource)return this._logger.log(f.Debug,`Skipping transport '${p[o]}' because it is not supported in your environment.'`),new h(`'${p[o]}' is not supported in your environment.`,o);this._logger.log(f.Debug,`Selecting transport '${p[o]}'.`);try{return this.features.reconnect=o===p.WebSockets?s:void 0,this._constructTransport(o)}catch(e){return e}}_isITransport(e){return e&&"object"==typeof e&&"connect"in e}_stopConnection(e){if(this._logger.log(f.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(f.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),e?this._logger.log(f.Error,`Connection disconnected with error '${e}'.`):this._logger.log(f.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(e=>{this._logger.log(f.Error,`TransportSendQueue.stop() threw error '${e}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(f.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(f.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if(!k.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(f.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const n=new URLSearchParams(t.searchParams);return n.has("negotiateVersion")||n.append("negotiateVersion",this._negotiateVersion.toString()),n.has("useStatefulReconnect")?"true"===n.get("useStatefulReconnect")&&(this._options._useStatefulReconnect=!0):!0===this._options._useStatefulReconnect&&n.append("useStatefulReconnect","true"),t.search=n.toString(),t.toString()}}class F{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new O,this._transportResult=new O,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new O),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new O;const e=this._transportResult;this._transportResult=void 0;const t="string"==typeof this._buffer[0]?this._buffer.join(""):F._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(t){e.reject(t)}}}static _concatBuffers(e){const t=e.map(e=>e.byteLength).reduce((e,t)=>e+t),n=new Uint8Array(t);let s=0;for(const t of e)n.set(new Uint8Array(t),s),s+=t.byteLength;return n.buffer}}class O{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class Z{static write(e){return`${e}${Z.RecordSeparator}`}static parse(e){if(e[e.length-1]!==Z.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(Z.RecordSeparator);return t.pop(),t}}Z.RecordSeparatorCode=30,Z.RecordSeparator=String.fromCharCode(Z.RecordSeparatorCode);class W{writeHandshakeRequest(e){return Z.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,n;if(C(e)){const s=new Uint8Array(e),o=s.indexOf(Z.RecordSeparatorCode);if(-1===o)throw new Error("Message is incomplete.");const r=o+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(s.slice(0,r))),n=s.byteLength>r?s.slice(r).buffer:null}else{const s=e,o=s.indexOf(Z.RecordSeparator);if(-1===o)throw new Error("Message is incomplete.");const r=o+1;t=s.substring(0,r),n=s.length>r?s.substring(r):null}const s=Z.parse(t),o=JSON.parse(s[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[n,o]}}!function(e){e[e.Invocation=1]="Invocation",e[e.StreamItem=2]="StreamItem",e[e.Completion=3]="Completion",e[e.StreamInvocation=4]="StreamInvocation",e[e.CancelInvocation=5]="CancelInvocation",e[e.Ping=6]="Ping",e[e.Close=7]="Close",e[e.Ack=8]="Ack",e[e.Sequence=9]="Sequence"}(w||(w={}));class j{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new T(this,e)}}class K{constructor(e,t,n){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=n}async _send(e){const t=this._protocol.writeMessage(e);let n=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let e=()=>{},s=()=>{};C(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(n=new Promise((t,n)=>{e=t,s=n})),this._messages.push(new V(t,this._totalMessageCount,e,s))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await n}_ack(e){let t=-1;for(let n=0;n<this._messages.length;n++){const s=this._messages[n];if(s._id<=e.sequenceId)t=n,C(s._message)?this._bufferedByteCount-=s._message.byteLength:this._bufferedByteCount-=s._message.length,s._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;s._resolver()}}-1!==t&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===w.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){e.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=0!==this._messages.length?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:w.Sequence,sequenceId:e}));const t=this._messages;for(const e of t)await this._connection.send(e._message);this._reconnectInProgress=!1}_dispose(e){null!=e||(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case w.Invocation:case w.StreamItem:case w.Completion:case w.StreamInvocation:case w.CancelInvocation:return!0;case w.Close:case w.Sequence:case w.Ping:case w.Ack:return!1}}_ackTimer(){void 0===this._ackTimerHandle&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:w.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class V{constructor(e,t,n,s){this._message=e,this._id=t,this._resolver=n,this._rejector=s}}!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Disconnecting="Disconnecting",e.Reconnecting="Reconnecting"}(b||(b={}));class X{static create(e,t,n,s,o,r,i){return new X(e,t,n,s,o,r,i)}constructor(e,t,n,s,o,r,i){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(f.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},y.isRequired(e,"connection"),y.isRequired(t,"logger"),y.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=null!=o?o:3e4,this.keepAliveIntervalInMilliseconds=null!=r?r:15e3,this._statefulReconnectBufferSize=null!=i?i:1e5,this._logger=t,this._protocol=n,this.connection=e,this._reconnectPolicy=s,this._handshakeProtocol=new W,this.connection.onreceive=e=>this._processIncomingData(e),this.connection.onclose=e=>this._connectionClosed(e),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=b.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:w.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==b.Disconnected&&this._connectionState!==b.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==b.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=b.Connecting,this._logger.log(f.Debug,"Starting HubConnection.");try{await this._startInternal(),k.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=b.Connected,this._connectionStarted=!0,this._logger.log(f.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=b.Disconnected,this._logger.log(f.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((e,t)=>{this._handshakeResolver=e,this._handshakeRejecter=t});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const n={protocol:this._protocol.name,version:t};if(this._logger.log(f.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(n)),this._logger.log(f.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;!!this.connection.features.reconnect&&(this._messageBuffer=new K(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(f.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch(e){}}_stopInternal(e){if(this._connectionState===b.Disconnected)return this._logger.log(f.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===b.Disconnecting)return this._logger.log(f.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=b.Disconnecting,this._logger.log(f.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(f.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===b.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new l("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[n,s]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,s);let r;const i=new j;return i.cancelCallback=()=>{const e=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],r.then(()=>this._sendWithProtocol(e))},this._callbacks[o.invocationId]=(e,t)=>{t?i.error(t):e&&(e.type===w.Completion?e.error?i.error(new Error(e.error)):i.complete():i.next(e.item))},r=this._sendWithProtocol(o).catch(e=>{i.error(e),delete this._callbacks[o.invocationId]}),this._launchStreams(n,r),i}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[n,s]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,s));return this._launchStreams(n,o),o}invoke(e,...t){const[n,s]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,s);return new Promise((e,t)=>{this._callbacks[o.invocationId]=(n,s)=>{s?t(s):n&&(n.type===w.Completion?n.error?t(new Error(n.error)):e(n.result):t(new Error(`Unexpected message type: ${n.type}`)))};const s=this._sendWithProtocol(o).catch(e=>{t(e),delete this._callbacks[o.invocationId]});this._launchStreams(n,s)})}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),-1===this._methods[e].indexOf(t)&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const n=this._methods[e];if(n)if(t){const s=n.indexOf(t);-1!==s&&(n.splice(s,1),0===n.length&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const e of t)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(e))switch(e.type){case w.Invocation:this._invokeClientMethod(e).catch(e=>{this._logger.log(f.Error,`Invoke client method threw error: ${P(e)}`)});break;case w.StreamItem:case w.Completion:{const t=this._callbacks[e.invocationId];if(t){e.type===w.Completion&&delete this._callbacks[e.invocationId];try{t(e)}catch(e){this._logger.log(f.Error,`Stream callback threw error: ${P(e)}`)}}break}case w.Ping:break;case w.Close:{this._logger.log(f.Information,"Close message received from server.");const t=e.error?new Error("Server returned an error on close: "+e.error):void 0;!0===e.allowReconnect?this.connection.stop(t):this._stopPromise=this._stopInternal(t);break}case w.Ack:this._messageBuffer&&this._messageBuffer._ack(e);break;case w.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(e);break;default:this._logger.log(f.Warning,`Invalid message type: ${e.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,n;try{[n,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(e){const t="Error parsing handshake response: "+e;this._logger.log(f.Error,t);const n=new Error(t);throw this._handshakeRejecter(n),n}if(t.error){const e="Server returned handshake error: "+t.error;this._logger.log(f.Error,e);const n=new Error(e);throw this._handshakeRejecter(n),n}return this._logger.log(f.Debug,"Server handshake complete."),this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!this.connection.features||!this.connection.features.inherentKeepAlive){this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds);let e=this._nextKeepAlive-(new Date).getTime();if(e<0)return void(this._connectionState===b.Connected&&this._trySendPingMessage());void 0===this._pingServerHandle&&(e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{this._connectionState===b.Connected&&await this._trySendPingMessage()},e))}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),n=this._methods[t];if(!n)return this._logger.log(f.Warning,`No client method with the name '${t}' found.`),void(e.invocationId&&(this._logger.log(f.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const s=n.slice(),o=!!e.invocationId;let r,i,a;for(const n of s)try{const s=r;r=await n.apply(this,e.arguments),o&&r&&s&&(this._logger.log(f.Error,`Multiple results provided for '${t}'. Sending error to server.`),a=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),i=void 0}catch(e){i=e,this._logger.log(f.Error,`A callback for the method '${t}' threw error '${e}'.`)}a?await this._sendWithProtocol(a):o?(i?a=this._createCompletionMessage(e.invocationId,`${i}`,null):void 0!==r?a=this._createCompletionMessage(e.invocationId,null,r):(this._logger.log(f.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),a=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(a)):r&&this._logger.log(f.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(f.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new l("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===b.Disconnecting?this._completeClose(e):this._connectionState===b.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===b.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=b.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(null!=e?e:new Error("Connection closed.")),this._messageBuffer=void 0),k.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(f.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let n=0,s=void 0!==e?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(n,0,s);if(null===o)return this._logger.log(f.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this._completeClose(e);if(this._connectionState=b.Reconnecting,e?this._logger.log(f.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(f.Information,"Connection reconnecting."),0!==this._reconnectingCallbacks.length){try{this._reconnectingCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(f.Error,`An onreconnecting callback called with error '${e}' threw error '${t}'.`)}if(this._connectionState!==b.Reconnecting)return void this._logger.log(f.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==o;){if(this._logger.log(f.Information,`Reconnect attempt number ${n+1} will start in ${o} ms.`),await new Promise(e=>{this._reconnectDelayHandle=setTimeout(e,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==b.Reconnecting)return void this._logger.log(f.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this._startInternal(),this._connectionState=b.Connected,this._logger.log(f.Information,"HubConnection reconnected successfully."),0!==this._reconnectedCallbacks.length)try{this._reconnectedCallbacks.forEach(e=>e.apply(this,[this.connection.connectionId]))}catch(e){this._logger.log(f.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`)}return}catch(e){if(this._logger.log(f.Information,`Reconnect attempt failed because of error '${e}'.`),this._connectionState!==b.Reconnecting)return this._logger.log(f.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this._connectionState===b.Disconnecting&&this._completeClose());n++,s=e instanceof Error?e:new Error(e.toString()),o=this._getNextRetryDelay(n,Date.now()-t,s)}}this._logger.log(f.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${n} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(n){return this._logger.log(f.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${n}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(n=>{const s=t[n];try{s(null,e)}catch(t){this._logger.log(f.Error,`Stream 'error' callback called with '${e}' threw error: ${P(t)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,n,s){if(n)return 0!==s.length?{target:e,arguments:t,streamIds:s,type:w.Invocation}:{target:e,arguments:t,type:w.Invocation};{const n=this._invocationId;return this._invocationId++,0!==s.length?{target:e,arguments:t,invocationId:n.toString(),streamIds:s,type:w.Invocation}:{target:e,arguments:t,invocationId:n.toString(),type:w.Invocation}}}_launchStreams(e,t){if(0!==e.length){t||(t=Promise.resolve());for(const n in e)e[n].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:e=>{let s;s=e instanceof Error?e.message:e&&e.toString?e.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,s)))},next:e=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,e)))}})}}_replaceStreamingParams(e){const t=[],n=[];for(let s=0;s<e.length;s++){const o=e[s];if(this._isObservable(o)){const r=this._invocationId;this._invocationId++,t[r]=o,n.push(r.toString()),e.splice(s,1)}}return[t,n]}_isObservable(e){return e&&e.subscribe&&"function"==typeof e.subscribe}_createStreamInvocation(e,t,n){const s=this._invocationId;return this._invocationId++,0!==n.length?{target:e,arguments:t,invocationId:s.toString(),streamIds:n,type:w.StreamInvocation}:{target:e,arguments:t,invocationId:s.toString(),type:w.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:w.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:w.StreamItem}}_createCompletionMessage(e,t,n){return t?{error:t,invocationId:e,type:w.Completion}:{invocationId:e,result:n,type:w.Completion}}_createCloseMessage(){return{type:w.Close}}async _trySendPingMessage(){try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}}}class G{constructor(){this.name="json",this.version=2,this.transferFormat=m.Text}parseMessages(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=v.instance);const n=Z.parse(e),s=[];for(const e of n){const n=JSON.parse(e);if("number"!=typeof n.type)throw new Error("Invalid payload.");switch(n.type){case w.Invocation:this._isInvocationMessage(n);break;case w.StreamItem:this._isStreamItemMessage(n);break;case w.Completion:this._isCompletionMessage(n);break;case w.Ping:case w.Close:break;case w.Ack:this._isAckMessage(n);break;case w.Sequence:this._isSequenceMessage(n);break;default:t.log(f.Information,"Unknown message type '"+n.type+"' ignored.");continue}s.push(n)}return s}writeMessage(e){return Z.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if("number"!=typeof e.sequenceId)throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if("number"!=typeof e.sequenceId)throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if("string"!=typeof e||""===e)throw new Error(t)}}const J={trace:f.Trace,debug:f.Debug,info:f.Information,information:f.Information,warn:f.Warning,warning:f.Warning,error:f.Error,critical:f.Critical,none:f.None};class Y{configureLogging(e){if(y.isRequired(e,"logging"),void 0!==e.log)this.logger=e;else if("string"==typeof e){const t=function(e){const t=J[e.toLowerCase()];if(void 0!==t)return t;throw new Error(`Unknown log level: ${e}`)}(e);this.logger=new x(t)}else this.logger=new x(e);return this}withUrl(e,t){return y.isRequired(e,"url"),y.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions="object"==typeof t?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return y.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new n(e):this.reconnectPolicy=e:this.reconnectPolicy=new n,this}withServerTimeout(e){return y.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return y.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return void 0===this.httpConnectionOptions&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=null==e?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new q(this.url,e);return X.create(t,this.logger||v.instance,this.protocol||new G,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Q(e){let t=e.length;for(;--t>=0;)e[t]=0}const ee=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),te=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ne=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),se=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),oe=new Array(576);Q(oe);const re=new Array(60);Q(re);const ie=new Array(512);Q(ie);const ae=new Array(256);Q(ae);const ce=new Array(29);Q(ce);const le=new Array(30);function he(e,t,n,s,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=o,this.has_stree=e&&e.length}let de,_e,ue;function ge(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Q(le);const fe=e=>e<256?ie[e]:ie[256+(e>>>7)],pe=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},me=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,pe(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},we=(e,t,n)=>{me(e,n[2*t],n[2*t+1])},be=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},ve=(e,t,n)=>{const s=new Array(16);let o,r,i=0;for(o=1;o<=15;o++)i=i+n[o-1]<<1,s[o]=i;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=be(s[t]++,t))}},ye=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},ke=e=>{e.bi_valid>8?pe(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Se=(e,t,n,s)=>{const o=2*t,r=2*n;return e[o]<e[r]||e[o]===e[r]&&s[t]<=s[n]},Ce=(e,t,n)=>{const s=e.heap[n];let o=n<<1;for(;o<=e.heap_len&&(o<e.heap_len&&Se(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!Se(t,s,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=s},Ee=(e,t,n)=>{let s,o,r,i,a=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+a++],s+=(255&e.pending_buf[e.sym_buf+a++])<<8,o=e.pending_buf[e.sym_buf+a++],0===s?we(e,o,t):(r=ae[o],we(e,r+256+1,t),i=ee[r],0!==i&&(o-=ce[r],me(e,o,i)),s--,r=fe(s),we(e,r,n),i=te[r],0!==i&&(s-=le[r],me(e,s,i)))}while(a<e.sym_next);we(e,256,t)},Te=(e,t)=>{const n=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.elems;let i,a,c,l=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<r;i++)0!==n[2*i]?(e.heap[++e.heap_len]=l=i,e.depth[i]=0):n[2*i+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,o&&(e.static_len-=s[2*c+1]);for(t.max_code=l,i=e.heap_len>>1;i>=1;i--)Ce(e,n,i);c=r;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ce(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=a,n[2*c]=n[2*i]+n[2*a],e.depth[c]=(e.depth[i]>=e.depth[a]?e.depth[i]:e.depth[a])+1,n[2*i+1]=n[2*a+1]=c,e.heap[1]=c++,Ce(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,s=t.max_code,o=t.stat_desc.static_tree,r=t.stat_desc.has_stree,i=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,h,d,_,u,g,f=0;for(_=0;_<=15;_++)e.bl_count[_]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)h=e.heap[l],_=n[2*n[2*h+1]+1]+1,_>c&&(_=c,f++),n[2*h+1]=_,h>s||(e.bl_count[_]++,u=0,h>=a&&(u=i[h-a]),g=n[2*h],e.opt_len+=g*(_+u),r&&(e.static_len+=g*(o[2*h+1]+u)));if(0!==f){do{for(_=c-1;0===e.bl_count[_];)_--;e.bl_count[_]--,e.bl_count[_+1]+=2,e.bl_count[c]--,f-=2}while(f>0);for(_=c;0!==_;_--)for(h=e.bl_count[_];0!==h;)d=e.heap[--l],d>s||(n[2*d+1]!==_&&(e.opt_len+=(_-n[2*d+1])*n[2*d],n[2*d+1]=_),h--)}})(e,t),ve(n,l,e.bl_count)},xe=(e,t,n)=>{let s,o,r=-1,i=t[1],a=0,c=7,l=4;for(0===i&&(c=138,l=3),t[2*(n+1)+1]=65535,s=0;s<=n;s++)o=i,i=t[2*(s+1)+1],++a<c&&o===i||(a<l?e.bl_tree[2*o]+=a:0!==o?(o!==r&&e.bl_tree[2*o]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,r=o,0===i?(c=138,l=3):o===i?(c=6,l=3):(c=7,l=4))},Ie=(e,t,n)=>{let s,o,r=-1,i=t[1],a=0,c=7,l=4;for(0===i&&(c=138,l=3),s=0;s<=n;s++)if(o=i,i=t[2*(s+1)+1],!(++a<c&&o===i)){if(a<l)do{we(e,o,e.bl_tree)}while(0!==--a);else 0!==o?(o!==r&&(we(e,o,e.bl_tree),a--),we(e,16,e.bl_tree),me(e,a-3,2)):a<=10?(we(e,17,e.bl_tree),me(e,a-3,3)):(we(e,18,e.bl_tree),me(e,a-11,7));a=0,r=o,0===i?(c=138,l=3):o===i?(c=6,l=3):(c=7,l=4)}};let Re=!1;const Ae=(e,t,n,s)=>{me(e,0+(s?1:0),3),ke(e),pe(e,n),pe(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var ze={_tr_init:e=>{Re||((()=>{let e,t,n,s,o;const r=new Array(16);for(n=0,s=0;s<28;s++)for(ce[s]=n,e=0;e<1<<ee[s];e++)ae[n++]=s;for(ae[n-1]=s,o=0,s=0;s<16;s++)for(le[s]=o,e=0;e<1<<te[s];e++)ie[o++]=s;for(o>>=7;s<30;s++)for(le[s]=o<<7,e=0;e<1<<te[s]-7;e++)ie[256+o++]=s;for(t=0;t<=15;t++)r[t]=0;for(e=0;e<=143;)oe[2*e+1]=8,e++,r[8]++;for(;e<=255;)oe[2*e+1]=9,e++,r[9]++;for(;e<=279;)oe[2*e+1]=7,e++,r[7]++;for(;e<=287;)oe[2*e+1]=8,e++,r[8]++;for(ve(oe,287,r),e=0;e<30;e++)re[2*e+1]=5,re[2*e]=be(e,5);de=new he(oe,ee,257,286,15),_e=new he(re,te,0,30,15),ue=new he(new Array(0),ne,0,19,7)})(),Re=!0),e.l_desc=new ge(e.dyn_ltree,de),e.d_desc=new ge(e.dyn_dtree,_e),e.bl_desc=new ge(e.bl_tree,ue),e.bi_buf=0,e.bi_valid=0,ye(e)},_tr_stored_block:Ae,_tr_flush_block:(e,t,n,s)=>{let o,r,i=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Te(e,e.l_desc),Te(e,e.d_desc),i=(e=>{let t;for(xe(e,e.dyn_ltree,e.l_desc.max_code),xe(e,e.dyn_dtree,e.d_desc.max_code),Te(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*se[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),o=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=o&&(o=r)):o=r=n+5,n+4<=o&&-1!==t?Ae(e,t,n,s):4===e.strategy||r===o?(me(e,2+(s?1:0),3),Ee(e,oe,re)):(me(e,4+(s?1:0),3),((e,t,n,s)=>{let o;for(me(e,t-257,5),me(e,n-1,5),me(e,s-4,4),o=0;o<s;o++)me(e,e.bl_tree[2*se[o]+1],3);Ie(e,e.dyn_ltree,t-1),Ie(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),Ee(e,e.dyn_ltree,e.dyn_dtree)),ye(e),s&&ke(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ae[n]+256+1)]++,e.dyn_dtree[2*fe(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{me(e,2,3),we(e,256,oe),(e=>{16===e.bi_valid?(pe(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},Pe=(e,t,n,s)=>{let o=65535&e,r=e>>>16&65535,i=0;for(;0!==n;){i=n>2e3?2e3:n,n-=i;do{o=o+t[s++]|0,r=r+o|0}while(--i);o%=65521,r%=65521}return o|r<<16};const De=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var $e=(e,t,n,s)=>{const o=De,r=s+n;e^=-1;for(let n=s;n<r;n++)e=e>>>8^o[255&(e^t[n])];return-1^e},Me={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ne={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Ue,_tr_stored_block:Le,_tr_flush_block:Be,_tr_tally:He,_tr_align:qe}=ze,{Z_NO_FLUSH:Fe,Z_PARTIAL_FLUSH:Oe,Z_FULL_FLUSH:Ze,Z_FINISH:We,Z_BLOCK:je,Z_OK:Ke,Z_STREAM_END:Ve,Z_STREAM_ERROR:Xe,Z_DATA_ERROR:Ge,Z_BUF_ERROR:Je,Z_DEFAULT_COMPRESSION:Ye,Z_FILTERED:Qe,Z_HUFFMAN_ONLY:et,Z_RLE:tt,Z_FIXED:nt,Z_DEFAULT_STRATEGY:st,Z_UNKNOWN:ot,Z_DEFLATED:rt}=Ne,it=258,at=262,ct=42,lt=113,ht=666,dt=(e,t)=>(e.msg=Me[t],t),_t=e=>2*e-(e>4?9:0),ut=e=>{let t=e.length;for(;--t>=0;)e[t]=0},gt=e=>{let t,n,s,o=e.w_size;t=e.hash_size,s=t;do{n=e.head[--s],e.head[s]=n>=o?n-o:0}while(--t);t=o,s=t;do{n=e.prev[--s],e.prev[s]=n>=o?n-o:0}while(--t)};let ft=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const pt=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},mt=(e,t)=>{Be(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,pt(e.strm)},wt=(e,t)=>{e.pending_buf[e.pending++]=t},bt=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},vt=(e,t,n,s)=>{let o=e.avail_in;return o>s&&(o=s),0===o?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),n),1===e.state.wrap?e.adler=Pe(e.adler,t,o,n):2===e.state.wrap&&(e.adler=$e(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)},yt=(e,t)=>{let n,s,o=e.max_chain_length,r=e.strstart,i=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-at?e.strstart-(e.w_size-at):0,l=e.window,h=e.w_mask,d=e.prev,_=e.strstart+it;let u=l[r+i-1],g=l[r+i];e.prev_length>=e.good_match&&(o>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,l[n+i]===g&&l[n+i-1]===u&&l[n]===l[r]&&l[++n]===l[r+1]){r+=2,n++;do{}while(l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&r<_);if(s=it-(_-r),r=_-it,s>i){if(e.match_start=t,i=s,s>=a)break;u=l[r+i-1],g=l[r+i]}}}while((t=d[t&h])>c&&0!==--o);return i<=e.lookahead?i:e.lookahead},kt=e=>{const t=e.w_size;let n,s,o;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-at)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),gt(e),s+=t),0===e.strm.avail_in)break;if(n=vt(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=ft(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=ft(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<at&&0!==e.strm.avail_in)},St=(e,t)=>{let n,s,o,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,i=0,a=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o)break;if(o=e.strm.avail_out-o,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>o&&(n=o),n<r&&(0===n&&t!==We||t===Fe||n!==s+e.strm.avail_in))break;i=t===We&&n===s+e.strm.avail_in?1:0,Le(e,0,0,i),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,pt(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(vt(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===i);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?4:t!==Fe&&t!==We&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(vt(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,r=o>e.w_size?e.w_size:o,s=e.strstart-e.block_start,(s>=r||(s||t===We)&&t!==Fe&&0===e.strm.avail_in&&s<=o)&&(n=s>o?o:s,i=t===We&&0===e.strm.avail_in&&n===s?1:0,Le(e,e.block_start,n,i),e.block_start+=n,pt(e.strm)),i?3:1)},Ct=(e,t)=>{let n,s;for(;;){if(e.lookahead<at){if(kt(e),e.lookahead<at&&t===Fe)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-at&&(e.match_length=yt(e,n)),e.match_length>=3)if(s=He(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ft(e,e.ins_h,e.window[e.strstart+1]);else s=He(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(mt(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===We?(mt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(mt(e,!1),0===e.strm.avail_out)?1:2},Et=(e,t)=>{let n,s,o;for(;;){if(e.lookahead<at){if(kt(e),e.lookahead<at&&t===Fe)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-at&&(e.match_length=yt(e,n),e.match_length<=5&&(e.strategy===Qe||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,s=He(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=ft(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(mt(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=He(e,0,e.window[e.strstart-1]),s&&mt(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=He(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===We?(mt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(mt(e,!1),0===e.strm.avail_out)?1:2};function Tt(e,t,n,s,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=o}const xt=[new Tt(0,0,0,0,St),new Tt(4,4,8,4,Ct),new Tt(4,5,16,8,Ct),new Tt(4,6,32,32,Ct),new Tt(4,4,16,16,Et),new Tt(8,16,32,32,Et),new Tt(8,16,128,128,Et),new Tt(8,32,128,256,Et),new Tt(32,128,258,1024,Et),new Tt(32,258,258,4096,Et)];function It(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=rt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ut(this.dyn_ltree),ut(this.dyn_dtree),ut(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ut(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ut(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Rt=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==ct&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==lt&&t.status!==ht?1:0},At=e=>{if(Rt(e))return dt(e,Xe);e.total_in=e.total_out=0,e.data_type=ot;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?ct:lt,e.adler=2===t.wrap?0:1,t.last_flush=-2,Ue(t),Ke},zt=e=>{const t=At(e);var n;return t===Ke&&((n=e.state).window_size=2*n.w_size,ut(n.head),n.max_lazy_match=xt[n.level].max_lazy,n.good_match=xt[n.level].good_length,n.nice_match=xt[n.level].nice_length,n.max_chain_length=xt[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Pt=(e,t,n,s,o,r)=>{if(!e)return Xe;let i=1;if(t===Ye&&(t=6),s<0?(i=0,s=-s):s>15&&(i=2,s-=16),o<1||o>9||n!==rt||s<8||s>15||t<0||t>9||r<0||r>nt||8===s&&1!==i)return dt(e,Xe);8===s&&(s=9);const a=new It;return e.state=a,a.strm=e,a.status=ct,a.wrap=i,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=o+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<o+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=r,a.method=n,zt(e)};var Dt=Pt,$t=(e,t)=>Rt(e)||2!==e.state.wrap?Xe:(e.state.gzhead=t,Ke),Mt=(e,t)=>{if(Rt(e)||t>je||t<0)return e?dt(e,Xe):Xe;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===ht&&t!==We)return dt(e,0===e.avail_out?Je:Xe);const s=n.last_flush;if(n.last_flush=t,0!==n.pending){if(pt(e),0===e.avail_out)return n.last_flush=-1,Ke}else if(0===e.avail_in&&_t(t)<=_t(s)&&t!==We)return dt(e,Je);if(n.status===ht&&0!==e.avail_in)return dt(e,Je);if(n.status===ct&&0===n.wrap&&(n.status=lt),n.status===ct){let t=rt+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=et||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=s<<6,0!==n.strstart&&(t|=32),t+=31-t%31,bt(n,t),0!==n.strstart&&(bt(n,e.adler>>>16),bt(n,65535&e.adler)),e.adler=1,n.status=lt,pt(e),0!==n.pending)return n.last_flush=-1,Ke}if(57===n.status)if(e.adler=0,wt(n,31),wt(n,139),wt(n,8),n.gzhead)wt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),wt(n,255&n.gzhead.time),wt(n,n.gzhead.time>>8&255),wt(n,n.gzhead.time>>16&255),wt(n,n.gzhead.time>>24&255),wt(n,9===n.level?2:n.strategy>=et||n.level<2?4:0),wt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(wt(n,255&n.gzhead.extra.length),wt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=$e(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(wt(n,0),wt(n,0),wt(n,0),wt(n,0),wt(n,0),wt(n,9===n.level?2:n.strategy>=et||n.level<2?4:0),wt(n,3),n.status=lt,pt(e),0!==n.pending)return n.last_flush=-1,Ke;if(69===n.status){if(n.gzhead.extra){let t=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let o=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=$e(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=o,pt(e),0!==n.pending)return n.last_flush=-1,Ke;t=0,s-=o}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>t&&(e.adler=$e(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=$e(e.adler,n.pending_buf,n.pending-s,s)),pt(e),0!==n.pending)return n.last_flush=-1,Ke;s=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,wt(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=$e(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=$e(e.adler,n.pending_buf,n.pending-s,s)),pt(e),0!==n.pending)return n.last_flush=-1,Ke;s=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,wt(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=$e(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(pt(e),0!==n.pending))return n.last_flush=-1,Ke;wt(n,255&e.adler),wt(n,e.adler>>8&255),e.adler=0}if(n.status=lt,pt(e),0!==n.pending)return n.last_flush=-1,Ke}if(0!==e.avail_in||0!==n.lookahead||t!==Fe&&n.status!==ht){let s=0===n.level?St(n,t):n.strategy===et?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(kt(e),0===e.lookahead)){if(t===Fe)return 1;break}if(e.match_length=0,n=He(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(mt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===We?(mt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(mt(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===tt?((e,t)=>{let n,s,o,r;const i=e.window;for(;;){if(e.lookahead<=it){if(kt(e),e.lookahead<=it&&t===Fe)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(o=e.strstart-1,s=i[o],s===i[++o]&&s===i[++o]&&s===i[++o])){r=e.strstart+it;do{}while(s===i[++o]&&s===i[++o]&&s===i[++o]&&s===i[++o]&&s===i[++o]&&s===i[++o]&&s===i[++o]&&s===i[++o]&&o<r);e.match_length=it-(r-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=He(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=He(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(mt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===We?(mt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(mt(e,!1),0===e.strm.avail_out)?1:2})(n,t):xt[n.level].func(n,t);if(3!==s&&4!==s||(n.status=ht),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),Ke;if(2===s&&(t===Oe?qe(n):t!==je&&(Le(n,0,0,!1),t===Ze&&(ut(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),pt(e),0===e.avail_out))return n.last_flush=-1,Ke}return t!==We?Ke:n.wrap<=0?Ve:(2===n.wrap?(wt(n,255&e.adler),wt(n,e.adler>>8&255),wt(n,e.adler>>16&255),wt(n,e.adler>>24&255),wt(n,255&e.total_in),wt(n,e.total_in>>8&255),wt(n,e.total_in>>16&255),wt(n,e.total_in>>24&255)):(bt(n,e.adler>>>16),bt(n,65535&e.adler)),pt(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Ke:Ve)},Nt=e=>{if(Rt(e))return Xe;const t=e.state.status;return e.state=null,t===lt?dt(e,Ge):Ke},Ut=(e,t)=>{let n=t.length;if(Rt(e))return Xe;const s=e.state,o=s.wrap;if(2===o||1===o&&s.status!==ct||s.lookahead)return Xe;if(1===o&&(e.adler=Pe(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){0===o&&(ut(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(n-s.w_size,n),0),t=e,n=s.w_size}const r=e.avail_in,i=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,kt(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=ft(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,kt(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=i,e.input=a,e.avail_in=r,s.wrap=o,Ke};const Lt=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Bt=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Lt(n,t)&&(e[t]=n[t])}}return e},Ht=e=>{let t=0;for(let n=0,s=e.length;n<s;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,s=0,o=e.length;t<o;t++){let o=e[t];n.set(o,s),s+=o.length}return n};let qt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){qt=!1}const Ft=new Uint8Array(256);for(let e=0;e<256;e++)Ft[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ft[254]=Ft[254]=1;var Ot=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,s,o,r,i=e.length,a=0;for(o=0;o<i;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<i&&(s=e.charCodeAt(o+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),o++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),r=0,o=0;r<a;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<i&&(s=e.charCodeAt(o+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),o++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},Zt=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,o;const r=new Array(2*n);for(o=0,s=0;s<n;){let t=e[s++];if(t<128){r[o++]=t;continue}let i=Ft[t];if(i>4)r[o++]=65533,s+=i-1;else{for(t&=2===i?31:3===i?15:7;i>1&&s<n;)t=t<<6|63&e[s++],i--;i>1?r[o++]=65533:t<65536?r[o++]=t:(t-=65536,r[o++]=55296|t>>10&1023,r[o++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&qt)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n})(r,o)},Wt=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Ft[e[n]]>t?n:t},jt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Kt=Object.prototype.toString,{Z_NO_FLUSH:Vt,Z_SYNC_FLUSH:Xt,Z_FULL_FLUSH:Gt,Z_FINISH:Jt,Z_OK:Yt,Z_STREAM_END:Qt,Z_DEFAULT_COMPRESSION:en,Z_DEFAULT_STRATEGY:tn,Z_DEFLATED:nn}=Ne;function sn(e){this.options=Bt({level:en,method:nn,chunkSize:16384,windowBits:15,memLevel:8,strategy:tn},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jt,this.strm.avail_out=0;let n=Dt(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Yt)throw new Error(Me[n]);if(t.header&&$t(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ot(t.dictionary):"[object ArrayBuffer]"===Kt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Ut(this.strm,e),n!==Yt)throw new Error(Me[n]);this._dict_set=!0}}function on(e,t){const n=new sn(t);if(n.push(e,!0),n.err)throw n.msg||Me[n.err];return n.result}sn.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize;let o,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Jt:Vt,"string"==typeof e?n.input=Ot(e):"[object ArrayBuffer]"===Kt.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(r===Xt||r===Gt)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=Mt(n,r),o===Qt)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=Nt(this.strm),this.onEnd(o),this.ended=!0,o===Yt;if(0!==n.avail_out){if(r>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},sn.prototype.onData=function(e){this.chunks.push(e)},sn.prototype.onEnd=function(e){e===Yt&&(this.result=Ht(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rn={Deflate:sn,deflate:on,deflateRaw:function(e,t){return(t=t||{}).raw=!0,on(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,on(e,t)},constants:Ne};const an=16209;var cn=function(e,t){let n,s,o,r,i,a,c,l,h,d,_,u,g,f,p,m,w,b,v,y,k,S,C,E;const T=e.state;n=e.next_in,C=e.input,s=n+(e.avail_in-5),o=e.next_out,E=e.output,r=o-(t-e.avail_out),i=o+(e.avail_out-257),a=T.dmax,c=T.wsize,l=T.whave,h=T.wnext,d=T.window,_=T.hold,u=T.bits,g=T.lencode,f=T.distcode,p=(1<<T.lenbits)-1,m=(1<<T.distbits)-1;e:do{u<15&&(_+=C[n++]<<u,u+=8,_+=C[n++]<<u,u+=8),w=g[_&p];t:for(;;){if(b=w>>>24,_>>>=b,u-=b,b=w>>>16&255,0===b)E[o++]=65535&w;else{if(!(16&b)){if(64&b){if(32&b){T.mode=16191;break e}e.msg="invalid literal/length code",T.mode=an;break e}w=g[(65535&w)+(_&(1<<b)-1)];continue t}for(v=65535&w,b&=15,b&&(u<b&&(_+=C[n++]<<u,u+=8),v+=_&(1<<b)-1,_>>>=b,u-=b),u<15&&(_+=C[n++]<<u,u+=8,_+=C[n++]<<u,u+=8),w=f[_&m];;){if(b=w>>>24,_>>>=b,u-=b,b=w>>>16&255,16&b){if(y=65535&w,b&=15,u<b&&(_+=C[n++]<<u,u+=8,u<b&&(_+=C[n++]<<u,u+=8)),y+=_&(1<<b)-1,y>a){e.msg="invalid distance too far back",T.mode=an;break e}if(_>>>=b,u-=b,b=o-r,y>b){if(b=y-b,b>l&&T.sane){e.msg="invalid distance too far back",T.mode=an;break e}if(k=0,S=d,0===h){if(k+=c-b,b<v){v-=b;do{E[o++]=d[k++]}while(--b);k=o-y,S=E}}else if(h<b){if(k+=c+h-b,b-=h,b<v){v-=b;do{E[o++]=d[k++]}while(--b);if(k=0,h<v){b=h,v-=b;do{E[o++]=d[k++]}while(--b);k=o-y,S=E}}}else if(k+=h-b,b<v){v-=b;do{E[o++]=d[k++]}while(--b);k=o-y,S=E}for(;v>2;)E[o++]=S[k++],E[o++]=S[k++],E[o++]=S[k++],v-=3;v&&(E[o++]=S[k++],v>1&&(E[o++]=S[k++]))}else{k=o-y;do{E[o++]=E[k++],E[o++]=E[k++],E[o++]=E[k++],v-=3}while(v>2);v&&(E[o++]=E[k++],v>1&&(E[o++]=E[k++]))}break}if(64&b){e.msg="invalid distance code",T.mode=an;break e}w=f[(65535&w)+(_&(1<<b)-1)]}}break}}while(n<s&&o<i);v=u>>3,n-=v,u-=v<<3,_&=(1<<u)-1,e.next_in=n,e.next_out=o,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=o<i?i-o+257:257-(o-i),T.hold=_,T.bits=u};const ln=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var un=(e,t,n,s,o,r,i,a)=>{const c=a.bits;let l,h,d,_,u,g,f=0,p=0,m=0,w=0,b=0,v=0,y=0,k=0,S=0,C=0,E=null;const T=new Uint16Array(16),x=new Uint16Array(16);let I,R,A,z=null;for(f=0;f<=15;f++)T[f]=0;for(p=0;p<s;p++)T[t[n+p]]++;for(b=c,w=15;w>=1&&0===T[w];w--);if(b>w&&(b=w),0===w)return o[r++]=20971520,o[r++]=20971520,a.bits=1,0;for(m=1;m<w&&0===T[m];m++);for(b<m&&(b=m),k=1,f=1;f<=15;f++)if(k<<=1,k-=T[f],k<0)return-1;if(k>0&&(0===e||1!==w))return-1;for(x[1]=0,f=1;f<15;f++)x[f+1]=x[f]+T[f];for(p=0;p<s;p++)0!==t[n+p]&&(i[x[t[n+p]]++]=p);if(0===e?(E=z=i,g=20):1===e?(E=ln,z=hn,g=257):(E=dn,z=_n,g=0),C=0,p=0,f=m,u=r,v=b,y=0,d=-1,S=1<<b,_=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){I=f-y,i[p]+1<g?(R=0,A=i[p]):i[p]>=g?(R=z[i[p]-g],A=E[i[p]-g]):(R=96,A=0),l=1<<f-y,h=1<<v,m=h;do{h-=l,o[u+(C>>y)+h]=I<<24|R<<16|A}while(0!==h);for(l=1<<f-1;C&l;)l>>=1;if(0!==l?(C&=l-1,C+=l):C=0,p++,0===--T[f]){if(f===w)break;f=t[n+i[p]]}if(f>b&&(C&_)!==d){for(0===y&&(y=b),u+=m,v=f-y,k=1<<v;v+y<w&&(k-=T[v+y],!(k<=0));)v++,k<<=1;if(S+=1<<v,1===e&&S>852||2===e&&S>592)return 1;d=C&_,o[d]=b<<24|v<<16|u-r}}return 0!==C&&(o[u+C]=f-y<<24|64<<16),a.bits=b,0};const{Z_FINISH:gn,Z_BLOCK:fn,Z_TREES:pn,Z_OK:mn,Z_STREAM_END:wn,Z_NEED_DICT:bn,Z_STREAM_ERROR:vn,Z_DATA_ERROR:yn,Z_MEM_ERROR:kn,Z_BUF_ERROR:Sn,Z_DEFLATED:Cn}=Ne,En=16180,Tn=16190,xn=16191,In=16192,Rn=16194,An=16199,zn=16200,Pn=16206,Dn=16209,$n=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Mn(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Nn=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<En||t.mode>16211?1:0},Un=e=>{if(Nn(e))return vn;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=En,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,mn},Ln=e=>{if(Nn(e))return vn;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Un(e)},Bn=(e,t)=>{let n;if(Nn(e))return vn;const s=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?vn:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,Ln(e))},Hn=(e,t)=>{if(!e)return vn;const n=new Mn;e.state=n,n.strm=e,n.window=null,n.mode=En;const s=Bn(e,t);return s!==mn&&(e.state=null),s};let qn,Fn,On=!0;const Zn=e=>{if(On){qn=new Int32Array(512),Fn=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(un(1,e.lens,0,288,qn,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;un(2,e.lens,0,32,Fn,0,e.work,{bits:5}),On=!1}e.lencode=qn,e.lenbits=9,e.distcode=Fn,e.distbits=5},Wn=(e,t,n,s)=>{let o;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),s>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>s&&(o=s),r.window.set(t.subarray(n-s,n-s+o),r.wnext),(s-=o)?(r.window.set(t.subarray(n-s,n),0),r.wnext=s,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0};var jn=Ln,Kn=Hn,Vn=(e,t)=>{let n,s,o,r,i,a,c,l,h,d,_,u,g,f,p,m,w,b,v,y,k,S,C=0;const E=new Uint8Array(4);let T,x;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Nn(e)||!e.output||!e.input&&0!==e.avail_in)return vn;n=e.state,n.mode===xn&&(n.mode=In),i=e.next_out,o=e.output,c=e.avail_out,r=e.next_in,s=e.input,a=e.avail_in,l=n.hold,h=n.bits,d=a,_=c,S=mn;e:for(;;)switch(n.mode){case En:if(0===n.wrap){n.mode=In;break}for(;h<16;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,E[0]=255&l,E[1]=l>>>8&255,n.check=$e(n.check,E,2,0),l=0,h=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=Dn;break}if((15&l)!==Cn){e.msg="unknown compression method",n.mode=Dn;break}if(l>>>=4,h-=4,k=8+(15&l),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=Dn;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:xn,l=0,h=0;break;case 16181:for(;h<16;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(n.flags=l,(255&n.flags)!==Cn){e.msg="unknown compression method",n.mode=Dn;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Dn;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&4&n.wrap&&(E[0]=255&l,E[1]=l>>>8&255,n.check=$e(n.check,E,2,0)),l=0,h=0,n.mode=16182;case 16182:for(;h<32;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}n.head&&(n.head.time=l),512&n.flags&&4&n.wrap&&(E[0]=255&l,E[1]=l>>>8&255,E[2]=l>>>16&255,E[3]=l>>>24&255,n.check=$e(n.check,E,4,0)),l=0,h=0,n.mode=16183;case 16183:for(;h<16;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&4&n.wrap&&(E[0]=255&l,E[1]=l>>>8&255,n.check=$e(n.check,E,2,0)),l=0,h=0,n.mode=16184;case 16184:if(1024&n.flags){for(;h<16;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&4&n.wrap&&(E[0]=255&l,E[1]=l>>>8&255,n.check=$e(n.check,E,2,0)),l=0,h=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(u=n.length,u>a&&(u=a),u&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(r,r+u),k)),512&n.flags&&4&n.wrap&&(n.check=$e(n.check,s,u,r)),a-=u,r+=u,n.length-=u),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===a)break e;u=0;do{k=s[r+u++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&u<a);if(512&n.flags&&4&n.wrap&&(n.check=$e(n.check,s,u,r)),a-=u,r+=u,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===a)break e;u=0;do{k=s[r+u++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&u<a);if(512&n.flags&&4&n.wrap&&(n.check=$e(n.check,s,u,r)),a-=u,r+=u,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;h<16;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Dn;break}l=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=xn;break;case 16189:for(;h<32;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}e.adler=n.check=$n(l),l=0,h=0,n.mode=Tn;case Tn:if(0===n.havedict)return e.next_out=i,e.avail_out=c,e.next_in=r,e.avail_in=a,n.hold=l,n.bits=h,bn;e.adler=n.check=1,n.mode=xn;case xn:if(t===fn||t===pn)break e;case In:if(n.last){l>>>=7&h,h-=7&h,n.mode=Pn;break}for(;h<3;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}switch(n.last=1&l,l>>>=1,h-=1,3&l){case 0:n.mode=16193;break;case 1:if(Zn(n),n.mode=An,t===pn){l>>>=2,h-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Dn}l>>>=2,h-=2;break;case 16193:for(l>>>=7&h,h-=7&h;h<32;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Dn;break}if(n.length=65535&l,l=0,h=0,n.mode=Rn,t===pn)break e;case Rn:n.mode=16195;case 16195:if(u=n.length,u){if(u>a&&(u=a),u>c&&(u=c),0===u)break e;o.set(s.subarray(r,r+u),i),a-=u,r+=u,c-=u,i+=u,n.length-=u;break}n.mode=xn;break;case 16196:for(;h<14;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(n.nlen=257+(31&l),l>>>=5,h-=5,n.ndist=1+(31&l),l>>>=5,h-=5,n.ncode=4+(15&l),l>>>=4,h-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Dn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;h<3;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}n.lens[I[n.have++]]=7&l,l>>>=3,h-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},S=un(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,S){e.msg="invalid code lengths set",n.mode=Dn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;C=n.lencode[l&(1<<n.lenbits)-1],p=C>>>24,m=C>>>16&255,w=65535&C,!(p<=h);){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(w<16)l>>>=p,h-=p,n.lens[n.have++]=w;else{if(16===w){for(x=p+2;h<x;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(l>>>=p,h-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=Dn;break}k=n.lens[n.have-1],u=3+(3&l),l>>>=2,h-=2}else if(17===w){for(x=p+3;h<x;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}l>>>=p,h-=p,k=0,u=3+(7&l),l>>>=3,h-=3}else{for(x=p+7;h<x;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}l>>>=p,h-=p,k=0,u=11+(127&l),l>>>=7,h-=7}if(n.have+u>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Dn;break}for(;u--;)n.lens[n.have++]=k}}if(n.mode===Dn)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Dn;break}if(n.lenbits=9,T={bits:n.lenbits},S=un(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,S){e.msg="invalid literal/lengths set",n.mode=Dn;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},S=un(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,S){e.msg="invalid distances set",n.mode=Dn;break}if(n.mode=An,t===pn)break e;case An:n.mode=zn;case zn:if(a>=6&&c>=258){e.next_out=i,e.avail_out=c,e.next_in=r,e.avail_in=a,n.hold=l,n.bits=h,cn(e,_),i=e.next_out,o=e.output,c=e.avail_out,r=e.next_in,s=e.input,a=e.avail_in,l=n.hold,h=n.bits,n.mode===xn&&(n.back=-1);break}for(n.back=0;C=n.lencode[l&(1<<n.lenbits)-1],p=C>>>24,m=C>>>16&255,w=65535&C,!(p<=h);){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(m&&!(240&m)){for(b=p,v=m,y=w;C=n.lencode[y+((l&(1<<b+v)-1)>>b)],p=C>>>24,m=C>>>16&255,w=65535&C,!(b+p<=h);){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}l>>>=b,h-=b,n.back+=b}if(l>>>=p,h-=p,n.back+=p,n.length=w,0===m){n.mode=16205;break}if(32&m){n.back=-1,n.mode=xn;break}if(64&m){e.msg="invalid literal/length code",n.mode=Dn;break}n.extra=15&m,n.mode=16201;case 16201:if(n.extra){for(x=n.extra;h<x;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;C=n.distcode[l&(1<<n.distbits)-1],p=C>>>24,m=C>>>16&255,w=65535&C,!(p<=h);){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(!(240&m)){for(b=p,v=m,y=w;C=n.distcode[y+((l&(1<<b+v)-1)>>b)],p=C>>>24,m=C>>>16&255,w=65535&C,!(b+p<=h);){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}l>>>=b,h-=b,n.back+=b}if(l>>>=p,h-=p,n.back+=p,64&m){e.msg="invalid distance code",n.mode=Dn;break}n.offset=w,n.extra=15&m,n.mode=16203;case 16203:if(n.extra){for(x=n.extra;h<x;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Dn;break}n.mode=16204;case 16204:if(0===c)break e;if(u=_-c,n.offset>u){if(u=n.offset-u,u>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Dn;break}u>n.wnext?(u-=n.wnext,g=n.wsize-u):g=n.wnext-u,u>n.length&&(u=n.length),f=n.window}else f=o,g=i-n.offset,u=n.length;u>c&&(u=c),c-=u,n.length-=u;do{o[i++]=f[g++]}while(--u);0===n.length&&(n.mode=zn);break;case 16205:if(0===c)break e;o[i++]=n.length,c--,n.mode=zn;break;case Pn:if(n.wrap){for(;h<32;){if(0===a)break e;a--,l|=s[r++]<<h,h+=8}if(_-=c,e.total_out+=_,n.total+=_,4&n.wrap&&_&&(e.adler=n.check=n.flags?$e(n.check,o,_,i-_):Pe(n.check,o,_,i-_)),_=c,4&n.wrap&&(n.flags?l:$n(l))!==n.check){e.msg="incorrect data check",n.mode=Dn;break}l=0,h=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;h<32;){if(0===a)break e;a--,l+=s[r++]<<h,h+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Dn;break}l=0,h=0}n.mode=16208;case 16208:S=wn;break e;case Dn:S=yn;break e;case 16210:return kn;default:return vn}return e.next_out=i,e.avail_out=c,e.next_in=r,e.avail_in=a,n.hold=l,n.bits=h,(n.wsize||_!==e.avail_out&&n.mode<Dn&&(n.mode<Pn||t!==gn))&&Wn(e,e.output,e.next_out,_-e.avail_out),d-=e.avail_in,_-=e.avail_out,e.total_in+=d,e.total_out+=_,n.total+=_,4&n.wrap&&_&&(e.adler=n.check=n.flags?$e(n.check,o,_,e.next_out-_):Pe(n.check,o,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(n.mode===xn?128:0)+(n.mode===An||n.mode===Rn?256:0),(0===d&&0===_||t===gn)&&S===mn&&(S=Sn),S},Xn=e=>{if(Nn(e))return vn;let t=e.state;return t.window&&(t.window=null),e.state=null,mn},Gn=(e,t)=>{if(Nn(e))return vn;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,mn):vn},Jn=(e,t)=>{const n=t.length;let s,o,r;return Nn(e)?vn:(s=e.state,0!==s.wrap&&s.mode!==Tn?vn:s.mode===Tn&&(o=1,o=Pe(o,t,n,0),o!==s.check)?yn:(r=Wn(e,t,n,n),r?(s.mode=16210,kn):(s.havedict=1,mn)))},Yn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Qn=Object.prototype.toString,{Z_NO_FLUSH:es,Z_FINISH:ts,Z_OK:ns,Z_STREAM_END:ss,Z_NEED_DICT:os,Z_STREAM_ERROR:rs,Z_DATA_ERROR:is,Z_MEM_ERROR:as}=Ne;function cs(e){this.options=Bt({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jt,this.strm.avail_out=0;let n=Kn(this.strm,t.windowBits);if(n!==ns)throw new Error(Me[n]);if(this.header=new Yn,Gn(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ot(t.dictionary):"[object ArrayBuffer]"===Qn.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Jn(this.strm,t.dictionary),n!==ns)))throw new Error(Me[n])}function ls(e,t){const n=new cs(t);if(n.push(e),n.err)throw n.msg||Me[n.err];return n.result}cs.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize,o=this.options.dictionary;let r,i,a;if(this.ended)return!1;for(i=t===~~t?t:!0===t?ts:es,"[object ArrayBuffer]"===Qn.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),r=Vn(n,i),r===os&&o&&(r=Jn(n,o),r===ns?r=Vn(n,i):r===is&&(r=os));n.avail_in>0&&r===ss&&n.state.wrap>0&&0!==e[n.next_in];)jn(n),r=Vn(n,i);switch(r){case rs:case is:case os:case as:return this.onEnd(r),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||r===ss))if("string"===this.options.to){let e=Wt(n.output,n.next_out),t=n.next_out-e,o=Zt(n.output,e);n.next_out=t,n.avail_out=s-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(o)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==ns||0!==a){if(r===ss)return r=Xn(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},cs.prototype.onData=function(e){this.chunks.push(e)},cs.prototype.onEnd=function(e){e===ns&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ht(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var hs={Inflate:cs,inflate:ls,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ls(e,t)},ungzip:ls,constants:Ne};const{Deflate:ds,deflate:_s,deflateRaw:us,gzip:gs}=rn,{Inflate:fs,inflate:ps,inflateRaw:ms,ungzip:ws}=hs;var bs={Deflate:ds,deflate:_s,deflateRaw:us,gzip:gs,Inflate:fs,inflate:ps,inflateRaw:ms,ungzip:ws,constants:Ne};let vs={cells:{},cellsBySymbol:{},dependencyGraph:{},cellValues:{},invokeSymbols:[]};const ys="SymbolLastTick",ks="SubscribeSymbols",Ss={Bid:"b",Ask:"a",LTP:"ltp",High:"h",Low:"l",Open:"o",Close:"c","Net Chng":"d",ATP:"atp","Bid Size":"bq","Total Bid Size":"tbq","Ask Size":"sq","Total Ask Size":"tsq",Volume:"vt","Open Interest":"oi","Last Size":"ltq",Time:"t",Identifier:"i",Name:"n"};function Cs(e){if(!e)return[];const t=e.match(/([A-Z]+\d+)/g);return t?[...new Set(t)]:[]}function Es(e,t){const n=vs.cells[e];n&&(vs.cellValues[e]=t,n.element.textContent=t,Ts(e))}function Ts(e){const t=vs.dependencyGraph[e];if(t&&0!==t.length)for(const e of t)xs(e)}function xs(e){const t=vs.cells[e];if("formula"!==t.type||!t.formula)return;const n={};for(const e of t.emitCells)n[e]=vs.cellValues[e]||0;const s=function(e,t){try{let n=e.replace(/^=SUM\(/,"").replace(/\)$/,"").replace(/^=/,"");const s=Cs(n);for(const e of s){const s=t[e];if(null==s||""===s)return"--";const o=parseFloat(s);if(isNaN(o))return"--";n=n.replaceAll(e,o)}const o=Function('"use strict"; return ('+n+")")();return isFinite(o)?o.toFixed(2):"--"}catch(e){return console.log("evaluateFormula error:",e),"--"}}(t.formula,n);vs.cellValues[e]=s,t.element.textContent=s,Ts(e)}function Is(e){try{const t=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),n=JSON.parse(bs.ungzip(t,{to:"string"})),s=n.i;if(!s)return;const o=vs.cellsBySymbol[s];if(o&&o.length)for(const e of o){const t=n[e.field]||"--";let s=t;if("t"==e.field&&"--"!==t)try{s=Rs(s)}catch(e){s=t}Es(e.cellId,s)}}catch(e){console.error("handleExcelRates error:",e)}}const Rs=e=>{let t;if(null==e||""===e)return"Invalid";const n=String(e).trim();if(isNaN(n)&&(n.includes("-")||n.includes("T")))t=new Date(n);else{let e=parseFloat(n);e<1e11&&(e*=1e3),t=new Date(e)}return isNaN(t.getTime())?"Invalid":(console.log("date :",t),t.toLocaleString("en-IN",{timeZone:"Asia/Kolkata",hour12:!0}))};document.addEventListener("DOMContentLoaded",function(){(function(){const e=document.querySelector("table.excel").querySelectorAll("tr");let t=[];e.forEach((e,n)=>{e.querySelectorAll("td").forEach((e,n)=>{const s=e.id,o=e.textContent.trim();if(!s)return;const r=function(e){return e&&e.startsWith("=")?e.includes("RTD")?"rtd":"formula":"static"}(o);let i=null,a=null,c=null;if("rtd"===r){const n=function(e){if(!e||!e.includes("RTD"))return null;const t=e.split('"');return{symbol:t.length>3?t[3]?.trim():null,field:t.length>5?Ss[t[5]?.trim()]:null}}(o);i=n?.symbol,a=n?.field,i&&a&&(vs.cellsBySymbol[i]||(vs.cellsBySymbol[i]=[]),vs.cellsBySymbol[i].push({cellId:s,field:a,element:e}),t.includes(i)||t.push(i))}else"formula"===r&&(c=Cs(o));vs.cells[s]={id:s,type:r,formula:o,symbol:i,field:a,emitCells:c,element:e},"static"!==r||o.startsWith("=")||(vs.cellValues[s]=o)})}),vs.invokeSymbols=t,function(){for(const e in vs.cells){const t=vs.cells[e];if("formula"===t.type&&t.emitCells){for(const n of t.emitCells)vs.dependencyGraph[n]||(vs.dependencyGraph[n]=[]),vs.dependencyGraph[n].push(e);1==t.emitCells.length&&(t.element.textContent=vs.cells[t.emitCells[0]].formula)}}}(),function(){try{const e=(new Y).withUrl("http://api.thecalcify.com/excel?user=calcify&auth=Starline@1008&type=mobile",{accessTokenFactory:()=>document.cookie.replace(/(?:(?:^|.*;\s*)AuthToken\s*\=\s*([^;]*).*$)|^.*$/,"$1"),transport:p.WebSockets|p.ServerSentEvents|p.LongPolling}).withAutomaticReconnect().build();e.on("excelRate",Is),e.start().then(()=>{e.invoke(ks,vs.invokeSymbols),e.invoke(ys,vs.invokeSymbols)}),e.onreconnected(()=>{vs.invokeSymbols.length>0&&(e.invoke(ks,vs.invokeSymbols),e.invoke(ys,vs.invokeSymbols))})}catch(e){throw console.error("SignalR connection error:",e),e}}()})(),console.log("Excel sheet initialized and ready")})})();